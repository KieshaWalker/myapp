<!DOCTYPE html>
<!--
  habits/index.ejs — Lists habits and shows a create form.
  EJS tag recap:
    <% %>   runs JS only
    <%= %>  outputs escaped content
    <%- %>  outputs raw HTML (safe for includes)
  We include the shared nav using <%- include('../partials/nav') %>.
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habits</title>
  <link rel="stylesheet" href="/index.css" />
</head>
<body>
  <header>
    <h1>Your Habits</h1>
    <%- include('../partials/nav') %>
  </header>

  <section>
    <form action="/habits" method="POST">
      <!-- All inputs use name=... which becomes req.body in the server (express.urlencoded). -->
      <input type="text" name="title" placeholder="Title" required />
      <input type="text" name="description" placeholder="Description" />
      <select name="frequency">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <input type="number" name="targetCount" placeholder="Target count" value="1" />
      <input type="number" name="duration" placeholder="Duration (days)" value="0" />
      <button type="submit">Add Habit</button>
    </form>

    <!-- Render a list if habits were passed from the controller. -->
    <ul>
      <% if (habits && habits.length) { %>
        <% habits.forEach(h => { %>
          <li>
            <!-- <%= %> escapes to prevent XSS when printing titles/descriptions. -->
            <strong><%= h.title %></strong> – <%= h.frequency %>
            <% if (h.habiticaTaskId) { %>
              <span title="Linked to Habitica" style="color: green;">(Habitica linked)</span>
            <% } %>
            <!-- Simple POST to mark complete; controller handles logging & sync. -->
            <form style="display:inline" action="/habits/<%= h._id %>/complete" method="POST">
              <button type="submit">Mark Complete</button>
            </form>
            <a href="/habits/<%= h._id %>/edit">Edit</a>
            <a href="/logs/<%= h._id %>">Logs</a>
            <!-- Method override: HTML forms can't send DELETE, so we use ?_method=DELETE and method-override middleware. -->
            <form style="display:inline" action="/habits/<%= h._id %>?_method=DELETE" method="POST">
              <button type="submit">Delete</button>
            </form>
          </li>
        <% }) %>
      <% } else { %>
        <li>No habits yet.</li>
      <% } %>
    </ul>
  </section>
</body>
</html>
